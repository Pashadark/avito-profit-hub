{% load static %}
<!DOCTYPE html>
<html lang="ru" class="light-style layout-navbar-fixed layout-menu-fixed layout-compact" dir="ltr" data-theme="theme-default" data-assets-path="{% static 'assets/' %}" data-template="vertical-menu-template">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>{% block title %}–°–µ–ª–∏–±—Ä–∏ - –°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π{% endblock %}</title>
    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'assets/img/favicon/favicon.ico' %}" />

    <!-- Fonts -->
    <link rel="preconnect" href="http://192.168.3.15:8000/" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Icons -->
    <link rel="stylesheet" href="{% static 'assets/vendor/fonts/remixicon/remixicon.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/fonts/flag-icons.css' %}" />

    <!-- Menu waves for no-customizer fix -->
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/node-waves/node-waves.css' %}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/base.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/css/rtl/core.css' %}" class="template-customizer-core-css" />
    <link rel="stylesheet" href="{% static 'assets/vendor/css/rtl/theme-default.css' %}" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="{% static 'assets/css/demo.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/css/custom-container.css' %}" />

    <!-- Widgets CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/widgets/widget-number.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/widgets/widget-progressbar.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/widgets/card-seller.css' %}" />

    <!-- –°ard CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/card/product-card.css' %}" />

    <!-- Toastr CSS -->
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/toastr/toastr.css' %}" />

    <!-- –ù–ê–®–ò –ù–û–í–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø CSS -->
    <link rel="stylesheet" href="{% static 'notifications/css/notifications.css' %}" />

    <!-- Vendor CSS -->
    {% block vendor_css %}
    <link rel="stylesheet" href="{% static 'assets/css/enhanced-search.css' %}" />
    {% endblock vendor_css %}

    <!-- Helpers -->
    <script src="{% static 'assets/vendor/js/helpers.js' %}"></script>
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{% static 'assets/js/config.js' %}"></script>

    <!-- Page specific CSS -->
    {% block page_css %}{% endblock page_css %}

</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->
            {% if not request.path == '/login/' and not request.path == '/admin/' %}
            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                    <a href="{% url 'website:dashboard' %}" class="app-brand-link">
                        <span class="app-brand-logo demo">
                            <img src="{% static 'assets/img/logo/logo.svg' %}" alt="–ö–∞—Ä–¥–∏–Ω–∞–ª" width="32" onerror="this.style.display='none'">
                        </span>
                        <span class="app-brand-text demo menu-text fw-semibold ms-2">–°–µ–ª–∏–±—Ä–∏</span>
                    </a>

                    <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-xl-none">
                        <i class="ri-close-line ri-lg"></i>
                    </a>
                </div>

                <div class="menu-inner-shadow"></div>
                <ul class="menu-inner py-1">
                    <!-- Dashboard -->
                    <li class="menu-header small mt-5">
                        <span class="menu-header-text">–û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é</span>
                    </li>
                    <li class="menu-item {% if request.path == '/' %}active{% endif %}">
                        <a href="{% url 'website:dashboard' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-home-smile-line"></i>
                            <div>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                        </a>
                    </li>

                    <!-- –¢–æ–≤–∞—Ä—ã -->
                    <li class="menu-item {% if request.path == '/found-items/' %}active{% endif %}">
                        <a href="{% url 'website:found_items' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-shopping-bag-3-line"></i>
                            <div>–û–±—ä—è–≤–ª–µ–Ω–∏–µ</div>
                        </a>
                    </li>

                    <!-- –ü–æ–∏—Å–∫ -->
                    <li class="menu-item {% if request.path == '/search/' %}active{% endif %}">
                        <a href="{% url 'website:search' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-search-line"></i>
                            <div>–ü–æ–∏—Å–∫</div>
                        </a>
                    </li>

                    <!-- –ü–∞—Ä—Å–µ—Ä -->
                    <li class="menu-item {% if request.path == '/parser-settings/' %}active{% endif %}">
                        <a href="{% url 'website:parser_settings' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-game-line"></i>
                            <div>–ü–∞—Ä—Å–µ—Ä</div>
                        </a>
                    </li>
                    <li class="menu-item {% if request.path == '/profile/' %}active{% endif %}">
                        <a href="{% url 'website:profile' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-user-line"></i>
                            <div>–ü—Ä–æ—Ñ–∏–ª—å</div>
                        </a>
                    </li>
                    <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
                    {% if request.user.is_staff or request.user.is_superuser %}
                    <li class="menu-header small mt-5">
                        <span class="menu-header-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span>
                    </li>

                    <li class="menu-item {% if request.path == '/debug-settings/' %}active{% endif %}">
                        <a href="{% url 'website:debug_settings' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-bug-line" style="color: #ff4757;"></i>
                            <div style="color: #ff4757;">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</div>
                        </a>
                    </li>

                    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
                    <li class="menu-item {% if request.path == '/admin-users/' %}active{% endif %}">
                        <a href="{% url 'website:admin_users' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-group-line" style="color: #ff4757;"></i>
                            <div style="color: #ff4757;">–ê–∫–∞—É–Ω—Ç—ã</div>
                        </a>
                    </li>
                    <li class="menu-item {% if request.path == '/todo/' %}active{% endif %}">
                        <a href="{% url 'website:todo_kanban' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-drag-drop-line" style="color: #ff4757;"></i>
                            <div style="color: #ff4757;">–ó–∞–¥–∞—á–∏</div>
                        </a>
                    </li>
                    <li class="menu-item {% if request.path == '#' %}active{% endif %}">
                        <a href="{% url 'website:todo_kanban' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-bar-chart-2-line" style="color: #ff4757;"></i>
                            <div style="color: #ff4757;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                        </a>
                    </li>
                    <li class="menu-item {% if request.path == '#' %}active{% endif %}">
                        <a href="{% url 'website:help' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-archive-2-line" style="color: #ff4757;"></i>
                            <div style="color: #ff4757;">–°—Ç—Ä—É–∫—Ç—É—Ä–∞</div>
                        </a>
                    </li>
                    <li class="menu-item {% if '/vision-statistics/' in request.path %}active{% endif %}">
                        <a href="{% url 'website:vision_statistics' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-brain-line" style="color: #ff4757;"></i>
                            <div style="color: #ff4757;">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç ML</div>
                        </a>
                    </li>
                    <li class="menu-item {% if 'statistics/parser/' in request.path %}active{% endif %}">
                        <a href="{% url 'website:parser_statistics' %}" class="menu-link">
                            <i class="menu-icon tf-icons ri-game-line" style="color: #ff4757;"></i>
                            <div style="color: #ff4757;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞</div>
                        </a>
                    </li>
                    {% endif %}

                    <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –≤ —Å–∞–º–æ–º –Ω–∏–∑—É -->
                    <li class="menu-item mt-auto" style="margin-bottom: 1rem;">
                        <form method="post" action="{% url 'logout' %}" class="d-inline w-100">
                            {% csrf_token %}
                            <a href="#" onclick="this.closest('form').submit(); return false;" class="menu-link" style="color: #ff4757;">
                                <i class="menu-icon tf-icons ri-logout-box-r-line" style="color: #ff4757;"></i>
                                <div style="color: #ff4757;">–í—ã–π—Ç–∏</div>
                            </a>
                        </form>
                    </li>
                </ul>
            </aside>
            {% endif %}
            <!-- / Menu -->

            <!-- Layout container -->
            <div class="layout-page">
                {% if not request.path == '/login/' and not request.path == '/admin/' %}
                <!-- Navbar -->
                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
                            <i class="ri-menu-fill ri-lg"></i>
                        </a>
                    </div>

                    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                        <!-- Search -->
                        <div class="navbar-nav align-items-center">
                            <div class="nav-item navbar-search-wrapper mb-0">
                                <a class="nav-item nav-link search-toggler fw-normal px-0" href="javascript:void(0);">
                                    <i class="ri-search-line ri-lg scaleX-n1-rtl me-3"></i>
                                    <span class="d-none d-md-inline-block text-muted">–ü–æ–∏—Å–∫... (Ctrl+/)</span>
                                </a>
                            </div>
                        </div>
                        <!-- /Search -->

                        <ul class="navbar-nav flex-row align-items-center ms-auto">
                            <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
                            <li class="nav-item me-2 me-xl-0 d-xl-none">
                                <a class="nav-link btn btn-text-secondary rounded-pill btn-icon search-toggler" href="javascript:void(0);" title="–ü–æ–∏—Å–∫">
                                    <i class="ri-search-line ri-lg"></i>
                                </a>
                            </li>

                            <!-- Fullscreen –∫–Ω–æ–ø–∫–∞ -->
                            <li class="nav-item me-2 me-xl-0">
                                <a class="nav-link btn btn-text-secondary rounded-pill btn-icon" href="javascript:void(0);" id="fullscreen-btn" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">
                                    <i class="ri-fullscreen-line ri-lg"></i>
                                </a>
                            </li>

                            <!-- Style Switcher -->
                            <li class="nav-item me-2 me-xl-0">
                                <a class="nav-link btn btn-text-secondary rounded-pill btn-icon theme-toggle" href="javascript:void(0);" id="theme-toggle-btn">
                                    <i class="ri-sun-line ri-lg theme-icon"></i>
                                </a>
                            </li>
                            <!-- / Style Switcher-->

                            <!-- Notification -->
                            <li class="nav-item dropdown-notifications navbar-dropdown dropdown me-3 me-xl-1">
                                <a class="nav-link btn btn-text-secondary rounded-pill btn-icon dropdown-toggle hide-arrow waves-effect waves-light" href="javascript:void(0);" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                                    <i class="ri-notification-2-line ri-lg"></i>
                                    <span class="position-absolute top-0 start-50 translate-middle-y badge badge-dot bg-danger mt-2 border"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end py-0">
                                    <li class="dropdown-menu-header border-bottom py-50">
                                        <div class="dropdown-header d-flex align-items-center py-2">
                                            <h6 class="mb-0 me-auto">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h6>
                                            <div class="d-flex align-items-center">
                                                <span class="badge rounded-pill bg-label-primary fs-xsmall me-2">3 –ù–æ–≤—ã—Ö</span>
                                                <a href="javascript:void(0)" class="btn btn-text-secondary rounded-pill btn-icon dropdown-notifications-all waves-effect waves-light" data-bs-toggle="tooltip" data-bs-placement="top" aria-label="Mark all as read" data-bs-original-title="Mark all as read"><i class="ri-mail-open-line text-heading ri-lg"></i></a>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="dropdown-notifications-list scrollable-container ps">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item list-group-item-action dropdown-notifications-item waves-effect">
                                                <div class="d-flex">
                                                    <div class="flex-shrink-0 me-3">
                                                        <div class="avatar">
                                                            <span class="avatar-initial rounded-circle bg-label-success"><i class="ri-shopping-bag-3-line"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="flex-grow-1">
                                                        <h6 class="small mb-1">–ù–∞–π–¥–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã</h6>
                                                        <small class="mb-1 d-block text-body">–ù–∞–π–¥–µ–Ω–æ 5 –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</small>
                                                        <small class="text-muted">5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥</small>
                                                    </div>
                                                    <div class="flex-shrink-0 dropdown-notifications-actions">
                                                        <a href="javascript:void(0)" class="dropdown-notifications-read"><span class="badge badge-dot"></span></a>
                                                        <a href="javascript:void(0)" class="dropdown-notifications-archive"><span class="ri-close-line ri-lg"></span></a>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="border-top">
                                        <div class="d-grid p-4">
                                            <a class="btn btn-primary btn-sm d-flex waves-effect waves-light" href="javascript:void(0);">
                                                <small class="align-middle">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</small>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                            <!--/ Notification -->

                            <!-- User -->
                            <li class="nav-item navbar-dropdown dropdown-user dropdown">
                                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown" aria-expanded="false">
                                    <div class="avatar avatar-online">
                                        <img src="{% if user_profile.avatar %}/{{ user_profile.avatar }}{% else %}{% static 'assets/img/avatars/1.png' %}{% endif %}"
                                             alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                                             class="rounded-circle"
                                             onerror="this.src='{% static 'images/default-avatar.png' %}'">
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <a class="dropdown-item waves-effect" href="/profile/">
                                            <div class="d-flex">
                                                <div class="flex-shrink-0 me-2">
                                                    <div class="avatar avatar-online">
                                                        <img src="{% if user_profile.avatar %}/{{ user_profile.avatar }}{% else %}{% static 'assets/img/avatars/1.png' %}{% endif %}"
                                                             alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                                                             class="rounded-circle"
                                                             onerror="this.src='{% static 'images/default-avatar.png' %}'">
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <span class="fw-medium d-block small">{% if user.username %}{{ user.username }}{% else %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å{% endif %}</span>
                                                    <small class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider"></div>
                                    </li>
                                    <li>
                                        <a class="dropdown-item waves-effect" href="/profile/">
                                            <i class="ri-settings-4-line me-3"></i><span class="align-middle">–ü—Ä–æ—Ñ–∏–ª—å</span>
                                        </a>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider"></div>
                                    </li>
                                    <li>
                                        <div class="d-grid px-4 pt-2 pb-1">
                                            <form method="post" action="/logout/" class="d-inline w-100">
                                                <input type="hidden" name="csrfmiddlewaretoken" value="sD3Mic2TR7Y0yLgTEmOZsXIqBL5ER0pb32ApzbqFQsUN3pu249IB2JaW9CeWQjuW">
                                                <button type="submit" class="btn btn-sm btn-danger d-flex w-100 waves-effect waves-light">
                                                    <small class="align-middle">–í—ã–π—Ç–∏</small>
                                                    <i class="ri-logout-box-r-line ms-2"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                            <!--/ User -->
                        </ul>
                    </div>

                    <!-- Search Small Screens -->
                    <div class="navbar-search-wrapper search-input-wrapper d-none">
                        <input type="text" class="form-control search-input container-xxl border-0" placeholder="Search..." aria-label="Search...">
                        <i class="ri-close-fill search-toggler cursor-pointer"></i>
                    </div>
                </nav>
                <!-- / Navbar -->
                {% endif %}

                <!-- Content wrapper -->
                <div class="content-wrapper">
                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y">
                        {% if request.path == '/login/' or request.path == '/admin/' %}
                        <div class="login-container-dtf">
                            {% block login_content %}
                            {% endblock %}
                        </div>
                        {% else %}
                        {% block content %}
                        {% endblock %}
                        {% endif %}
                    </div>
                    <!-- / Content -->

                    <!-- Footer -->
                    <footer class="content-footer footer bg-footer-theme">
                        <div class="container-xxl">
                            <div class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
                                <div class="text-body mb-2 mb-md-0 text-center w-100" style="font-size: 12px;">
                                    ¬©
                                    <script>
                                        document.write(new Date().getFullYear());
                                    </script>
                                    –°–µ–ª–∏–±—Ä–∏ –í–Ω–∏–º–∞–Ω–∏–µ! –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±—Ä–∞–Ω—ã –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –§–ó ¬´–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø. 4 —á. 2 —Å—Ç. 22 –§–ó
                                </div>
                            </div>
                        </div>
                    </footer>
                    <!-- / Footer -->

                    <div class="content-backdrop fade"></div>
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>

        <!-- Drag Target Area To SlideIn Menu On Small Screens -->
        <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <script src="{% static 'assets/vendor/libs/jquery/jquery.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/popper/popper.js' %}"></script>
    <script src="{% static 'assets/vendor/js/bootstrap.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/node-waves/node-waves.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/hammer/hammer.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/i18n/i18n.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/typeahead-js/typeahead.js' %}"></script>
    <script src="{% static 'assets/vendor/js/menu.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/apex-charts/apexcharts.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/swiper/swiper.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>

    <!-- Template customizer –¥–ª—è search –∏ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π -->
    <script src="{% static 'assets/vendor/js/template-customizer.js' %}"></script>
    <script src="{% static 'assets/js/theme-switcher.js' %}"></script>
    <script src="{% static 'js/weather-widget.js' %}"></script>

    <script src="{% static 'assets/vendor/libs/toastr/toastr.js' %}"></script>
    <script src="{% static 'notifications/js/notifications.js' %}"></script>

    <!-- Main JS -->
    <script src="{% static 'assets/js/main.js' %}"></script>
    <script src="{% static 'assets/js/fullscreen.js' %}"></script>
    <script src="{% static 'assets/js/theme-toggle.js' %}"></script>

    <!-- Page JS -->
    {% block page_js %}{% endblock page_js %}

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
    <div class="modal fade" id="filesModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üìä –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="fileSearch" placeholder="–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤...">
                            <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">‚ùå</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th width="50">‚Ññ</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–§–∞–π–ª</th>
                                    <th>–†–∞–∑–º–µ—Ä</th>
                                    <th width="100">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="filesList">
                                <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-3">
                        <div class="alert alert-info mb-3">
                            <h6 class="alert-heading">üìã –°–ø–∏—Å–æ–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:</h6>
                            <textarea id="copyList" class="form-control" rows="4" readonly></textarea>
                        </div>

                        <div class="d-flex gap-2">
                            <button class="btn btn-success" onclick="copyToClipboard()">
                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫
                            </button>
                            <button class="btn btn-outline-primary" onclick="exportToFile()">
                                üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–∞–π–ª
                            </button>
                            <button class="btn btn-outline-danger" onclick="showUnusedFiles()">
                                ‚ùå –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <small class="text-muted me-auto" id="statsInfo"></small>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div class="modal fade" id="projectStructureModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üå≥ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="structureSearch" placeholder="–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫...">
                            <button class="btn btn-outline-secondary" type="button" onclick="clearStructureSearch()">‚ùå</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">üìÅ –î–µ—Ä–µ–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</h6>
                                </div>
                                <div class="card-body">
                                    <div id="structureTree" style="max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px;">
                                        <!-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                                </div>
                                <div class="card-body">
                                    <div id="structureStats">
                                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive mb-3">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>–¢–∏–ø</th>
                                    <th>–§–∞–π–ª</th>
                                    <th>–†–∞–∑–º–µ—Ä</th>
                                    <th>–ü—É—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody id="structureFilesList">
                                <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω -->
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-3">
                        <div class="alert alert-info mb-3">
                            <h6 class="alert-heading">üìã –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:</h6>
                            <textarea id="structureText" class="form-control" rows="6" readonly></textarea>
                        </div>

                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-success" onclick="copyStructureToClipboard()">
                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                            </button>
                            <button class="btn btn-outline-primary" onclick="exportStructureToFile()">
                                üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–∞–π–ª
                            </button>
                            <button class="btn btn-outline-warning" onclick="refreshProjectStructure()">
                                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                            </button>
                            <button class="btn btn-outline-info" onclick="showLargeFiles()">
                                üíæ –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (>100KB)
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <small class="text-muted me-auto">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdateTime">--:--</span></small>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –õ–æ–∞–¥–µ—Ä -->
    <div id="structureLoader" class="loader-overlay" style="display: none; position: fixed; z-index: 9999;">
        <div class="loader-content text-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
            <p class="mt-3">–ó–∞–≥—Ä—É–∂–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞...</p>
        </div>
    </div>

    <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    {% if debug or request.user.is_staff %}
    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px;">
        <button onclick="testNotifications()" class="btn btn-warning btn-sm shadow-sm" style="border-radius: 20px; padding: 8px 16px;">
            <i class="ri-notification-3-line me-1"></i> Test Toast
        </button>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–æ–≤ -->
        <button onclick="analyzePageFiles()" class="btn btn-info btn-sm shadow-sm" style="border-radius: 20px; padding: 8px 16px;">
            <i class="ri-file-list-line me-1"></i> File Audit
        </button>

        <!-- –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ -->
        <button onclick="loadProjectStructure()" class="btn btn-success btn-sm shadow-sm" style="border-radius: 20px; padding: 8px 16px;">
            <i class="ri-folder-tree-line me-1"></i> Project Structure
        </button>
    </div>
    {% endif %}

    <script>
    // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–¢–†–£–ö–¢–£–†–´ –ü–†–û–ï–ö–¢–ê ==========

    function showStructureLoader() {
        document.getElementById('structureLoader').style.display = 'flex';
    }

    function hideStructureLoader() {
        document.getElementById('structureLoader').style.display = 'none';
    }

    function loadProjectStructure() {
        showStructureLoader();
        
        fetch('/export-project-structure/', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            hideStructureLoader();
            
            if (data.status === 'success') {
                showProjectStructureModal(data);
            } else {
                notificationError(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã', '–û—à–∏–±–∫–∞');
            }
        })
        .catch(error => {
            hideStructureLoader();
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:', error);
            
            // –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            if (error.message.includes('404')) {
                showExampleStructure();
            } else {
                notificationError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
        });
    }

    function showExampleStructure() {
        const exampleData = {
            structure: [
                "project/",
                "  manage.py",
                "  requirements.txt",
                "  README.md",
                "  .gitignore",
                "  static/",
                "    css/",
                "      base.css",
                "      parser-settings.css",
                "    js/",
                "      main.js",
                "    images/",
                "  templates/",
                "    base.html",
                "    dashboard.html",
                "  app/",
                "    __init__.py",
                "    models.py",
                "    views.py",
                "    urls.py",
                "    admin.py"
            ],
            important_files: [
                "manage.py",
                "requirements.txt",
                "README.md",
                ".gitignore",
                "static/css/base.css",
                "static/css/parser-settings.css",
                "templates/base.html",
                "app/models.py",
                "app/views.py",
                "app/urls.py"
            ],
            statistics: {
                total_files: 15,
                python_files: 5,
                html_files: 2,
                css_files: 2,
                js_files: 1,
                other_files: 5,
                total_size: "245 KB"
            }
        };
        
        showProjectStructureModal(exampleData);
    }

    function showProjectStructureModal(data) {
        const treeElement = document.getElementById('structureTree');
        const filesListElement = document.getElementById('structureFilesList');
        const statsElement = document.getElementById('structureStats');
        const structureTextElement = document.getElementById('structureText');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
        document.getElementById('lastUpdateTime').textContent = 
            new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–µ—Ä–µ–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        treeElement.innerHTML = '';
        if (data.structure && Array.isArray(data.structure)) {
            data.structure.forEach(line => {
                const div = document.createElement('div');
                div.className = 'structure-line';
                div.textContent = line;
                treeElement.appendChild(div);
            });
        } else {
            treeElement.innerHTML = '<div class="text-muted">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>';
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤–∞–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        filesListElement.innerHTML = '';
        if (data.important_files && Array.isArray(data.important_files)) {
            data.important_files.forEach((file, index) => {
                const row = document.createElement('tr');
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
                let type = 'üìÑ';
                let typeClass = 'text-info';
                if (file.endsWith('.py')) {
                    type = 'üêç';
                    typeClass = 'text-success';
                } else if (file.endsWith('.html')) {
                    type = 'üåê';
                    typeClass = 'text-warning';
                } else if (file.endsWith('.css')) {
                    type = 'üé®';
                    typeClass = 'text-primary';
                } else if (file.endsWith('.js')) {
                    type = '‚ö°';
                    typeClass = 'text-warning';
                }
                
                row.innerHTML = `
                    <td><span class="${typeClass}">${type}</span></td>
                    <td><code>${file}</code></td>
                    <td><span class="badge bg-secondary">${data.file_sizes && data.file_sizes[file] ? data.file_sizes[file] : '?'}</span></td>
                    <td><small class="text-muted">/${file}</small></td>
                `;
                filesListElement.appendChild(row);
            });
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        statsElement.innerHTML = '';
        if (data.statistics) {
            const stats = data.statistics;
            statsElement.innerHTML = `
                <div class="mb-2">
                    <strong>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong>
                </div>
                <div class="row g-2 small">
                    <div class="col-6">
                        <span class="text-muted">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:</span>
                        <div class="fw-semibold">${stats.total_files || 0}</div>
                    </div>
                    <div class="col-6">
                        <span class="text-muted">Python —Ñ–∞–π–ª—ã:</span>
                        <div class="fw-semibold">${stats.python_files || 0}</div>
                    </div>
                    <div class="col-6">
                        <span class="text-muted">HTML —Ñ–∞–π–ª—ã:</span>
                        <div class="fw-semibold">${stats.html_files || 0}</div>
                    </div>
                    <div class="col-6">
                        <span class="text-muted">CSS —Ñ–∞–π–ª—ã:</span>
                        <div class="fw-semibold">${stats.css_files || 0}</div>
                    </div>
                    <div class="col-6">
                        <span class="text-muted">JS —Ñ–∞–π–ª—ã:</span>
                        <div class="fw-semibold">${stats.js_files || 0}</div>
                    </div>
                    <div class="col-6">
                        <span class="text-muted">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:</span>
                        <div class="fw-semibold">${stats.total_size || '?'}</div>
                    </div>
                </div>
            `;
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        let fullText = "–°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê –°–ï–õ–ò–ë–†–ò\n";
        fullText += "=".repeat(50) + "\n\n";
        
        if (data.structure) {
            fullText += "üå≥ –î–ï–†–ï–í–û –°–¢–†–£–ö–¢–£–†–´:\n";
            fullText += data.structure.join('\n') + "\n\n";
        }
        
        if (data.important_files) {
            fullText += "üìÅ –í–ê–ñ–ù–´–ï –§–ê–ô–õ–´:\n";
            data.important_files.forEach(file => {
                fullText += `  ‚Ä¢ ${file}\n`;
            });
            fullText += "\n";
        }
        
        if (data.statistics) {
            fullText += "üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:\n";
            Object.entries(data.statistics).forEach(([key, value]) => {
                fullText += `  ${key}: ${value}\n`;
            });
        }
        
        structureTextElement.value = fullText;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = new bootstrap.Modal(document.getElementById('projectStructureModal'));
        modal.show();
    }

    function refreshProjectStructure() {
        notificationInfo('–û–±–Ω–æ–≤–ª—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞...', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ');
        loadProjectStructure();
    }

    function copyStructureToClipboard() {
        const textarea = document.getElementById('structureText');
        textarea.select();
        textarea.setSelectionRange(0, 99999);
        
        navigator.clipboard.writeText(textarea.value).then(() => {
            notificationSuccess('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', '–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ');
        });
    }

    function exportStructureToFile() {
        const content = document.getElementById('structureText').value;
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const date = new Date().toISOString().slice(0, 10);
        a.download = `project-structure-${date}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        notificationSuccess('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Ñ–∞–π–ª!', '–≠–∫—Å–ø–æ—Ä—Ç');
    }

    function clearStructureSearch() {
        document.getElementById('structureSearch').value = '';
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
    }

    function showLargeFiles() {
        notificationInfo('–§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è');
    }

    // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê –§–ê–ô–õ–û–í –°–¢–†–ê–ù–ò–¶–´ ==========

    async function analyzePageFiles() {
        showLoading('üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ñ–∞–π–ª—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ...');

        try {
            const files = {
                css: [],
                js: [],
                images: [],
                fonts: [],
                other: []
            };

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã
            document.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
                if (link.href) {
                    files.css.push({
                        url: link.href,
                        type: 'CSS'
                    });
                }
            });

            document.querySelectorAll('script[src]').forEach(script => {
                if (script.src) {
                    files.js.push({
                        url: script.src,
                        type: 'JS'
                    });
                }
            });

            document.querySelectorAll('img[src]').forEach(img => {
                if (img.src) {
                    files.images.push({
                        url: img.src,
                        type: 'Image'
                    });
                }
            });

            document.querySelectorAll('link[rel*="icon"], link[rel*="apple-touch-icon"]').forEach(link => {
                if (link.href) {
                    files.images.push({
                        url: link.href,
                        type: 'Icon'
                    });
                }
            });

            document.querySelectorAll('link[rel*="font"], link[href*="fonts.googleapis.com"]').forEach(link => {
                if (link.href) {
                    files.fonts.push({
                        url: link.href,
                        type: 'Font'
                    });
                }
            });

            document.querySelectorAll('link[rel="preconnect"], link[rel="preload"]').forEach(link => {
                if (link.href) {
                    files.other.push({
                        url: link.href,
                        type: 'Preload'
                    });
                }
            });

            await checkFileSizes(files);
            showFilesModal(files);

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–æ–≤:', error);
            notificationError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ñ–∞–π–ª–æ–≤', 'File Audit Error');
        }
    }

    async function checkFileSizes(files) {
        const allFiles = [...files.css, ...files.js, ...files.images, ...files.fonts, ...files.other];

        for (const file of allFiles) {
            try {
                if (file.url.startsWith('http') && !file.url.includes(window.location.origin) ||
                    file.url.startsWith('data:')) {
                    file.size = 'External';
                    continue;
                }

                const response = await fetch(file.url, { method: 'HEAD' });
                const size = response.headers.get('content-length');

                if (size) {
                    file.size = formatBytes(size);
                } else {
                    file.size = 'Unknown';
                }
            } catch {
                file.size = 'Error';
            }
        }
    }

    function formatBytes(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function showFilesModal(files) {
        const filesList = document.getElementById('filesList');
        const copyList = document.getElementById('copyList');
        const statsInfo = document.getElementById('statsInfo');

        filesList.innerHTML = '';

        const allFiles = [
            ...files.css.map(f => ({...f, category: 'CSS'})),
            ...files.js.map(f => ({...f, category: 'JS'})),
            ...files.images.map(f => ({...f, category: 'Images'})),
            ...files.fonts.map(f => ({...f, category: 'Fonts'})),
            ...files.other.map(f => ({...f, category: 'Other'}))
        ];

        const totalFiles = allFiles.length;
        const cssCount = files.css.length;
        const jsCount = files.js.length;
        const imagesCount = files.images.length;

        let copyText = '';
        allFiles.forEach((file, index) => {
            const row = document.createElement('tr');

            let icon = 'üìÑ';
            if (file.category === 'CSS') icon = 'üé®';
            else if (file.category === 'JS') icon = '‚ö°';
            else if (file.category === 'Images') icon = 'üñºÔ∏è';
            else if (file.category === 'Fonts') icon = 'üî§';

            row.innerHTML = `
                <td>${index + 1}</td>
                <td><span class="badge bg-primary">${icon} ${file.category}</span></td>
                <td>
                    <div style="font-family: monospace; font-size: 12px;">
                        ${extractFileName(file.url)}
                    </div>
                    <small class="text-muted">${file.url}</small>
                </td>
                <td><span class="badge bg-secondary">${file.size || 'N/A'}</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="copyFileUrl('${escapeString(file.url)}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL">
                        üìã
                    </button>
                    <button class="btn btn-sm btn-outline-info" onclick="openInNewTab('${escapeString(file.url)}')" title="–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ">
                        ‚ÜóÔ∏è
                    </button>
                </td>
            `;

            filesList.appendChild(row);
            copyText += `${file.category}: ${file.url}\n`;
        });

        copyList.value = copyText;
        statsInfo.innerHTML = `–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: ${totalFiles} | CSS: ${cssCount} | JS: ${jsCount} | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${imagesCount}`;

        const modal = new bootstrap.Modal(document.getElementById('filesModal'));
        modal.show();
    }

    function extractFileName(url) {
        try {
            const urlObj = new URL(url);
            const pathname = urlObj.pathname;
            return pathname.split('/').pop() || url;
        } catch {
            return url.split('/').pop() || url;
        }
    }

    function escapeString(str) {
        return str.replace(/'/g, "\\'").replace(/"/g, '&quot;');
    }

    function copyFileUrl(url) {
        navigator.clipboard.writeText(url).then(() => {
            notificationSuccess('URL —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', '–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ');
        });
    }

    function openInNewTab(url) {
        window.open(url, '_blank');
    }

    function copyToClipboard() {
        const copyText = document.getElementById('copyList');
        copyText.select();
        copyText.setSelectionRange(0, 99999);

        navigator.clipboard.writeText(copyText.value).then(() => {
            notificationSuccess('–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', '–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ');
        });
    }

    function exportToFile() {
        const content = document.getElementById('copyList').value;
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `file-audit-${new Date().toISOString().slice(0, 10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        notificationSuccess('–§–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!', '–≠–∫—Å–ø–æ—Ä—Ç');
    }

    function clearSearch() {
        document.getElementById('fileSearch').value = '';
    }

    function showUnusedFiles() {
        notificationInfo('–§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'Info');
    }

    function showLoading(message) {
        toastr.info(message, '–ê–Ω–∞–ª–∏–∑', {
            timeOut: 2000,
            positionClass: 'toast-top-right'
        });
    }

    // ========== –¢–ï–°–¢ –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ==========

    function testNotifications() {
        notificationSuccess('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!', '–£—Å–ø–µ—Ö');

        setTimeout(() => {
            notificationError('‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞', '–û—à–∏–±–∫–∞');
        }, 600);

        setTimeout(() => {
            notificationInfo('‚ÑπÔ∏è –≠—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è');
        }, 1200);

        setTimeout(() => {
            notificationWarning('‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ');
        }, 1800);

        setTimeout(() => {
            notificationImportant('üö® –í–ù–ò–ú–ê–ù–ò–ï! –í–∞–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!', '–í–∞–∂–Ω–æ!');
        }, 2400);
    }

    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
    window.analyzePageFiles = analyzePageFiles;
    window.loadProjectStructure = loadProjectStructure;
    window.testToast = testNotifications;
    </script>

    <style>
    .loader-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
        z-index: 10000;
    }
    
    .structure-line {
        font-family: 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.4;
        padding: 1px 0;
        white-space: pre;
    }
    
    .structure-line:hover {
        background-color: #f8f9fa;
    }
    
    @media (max-width: 768px) {
        #projectStructureModal .modal-dialog {
            margin: 0.5rem;
        }
        
        #structureTree {
            max-height: 300px;
            font-size: 10px;
        }
    }
    </style>
</body>
</html>