<!-- notifications/templates/notifications/toast_container.html -->

{# CSS –¥–ª—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π #}
<link rel="stylesheet" href="/static/notifications/css/notifications.css">

{# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π #}
<div id="notification-container-global" class="notification-container notification-top-right"></div>

{# –î–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    const notificationData = {{ notifications_json|safe }};

    console.log('üì¶ Notification data loaded:', notificationData.length, 'items');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö
    notificationData.forEach(function(notification) {
        if (notification.template === 'notifications' || notification.template === 'materialize') {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
            showNotificationToast(notification);
        } else {
            // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π toastr (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
            switch(notification.type) {
                case 'success':
                    if (typeof notificationSuccess === 'function') {
                        notificationSuccess(notification.message, notification.title);
                    } else if (typeof toastr !== 'undefined') {
                        toastr.success(notification.message, notification.title);
                    }
                    break;
                case 'error':
                    if (typeof notificationError === 'function') {
                        notificationError(notification.message, notification.title);
                    } else if (typeof toastr !== 'undefined') {
                        toastr.error(notification.message, notification.title);
                    }
                    break;
                case 'warning':
                    if (typeof notificationWarning === 'function') {
                        notificationWarning(notification.message, notification.title);
                    } else if (typeof toastr !== 'undefined') {
                        toastr.warning(notification.message, notification.title);
                    }
                    break;
                case 'info':
                default:
                    if (typeof notificationInfo === 'function') {
                        notificationInfo(notification.message, notification.title);
                    } else if (typeof toastr !== 'undefined') {
                        toastr.info(notification.message, notification.title);
                    }
                    break;
            }
        }
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ toast –≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
    function showNotificationToast(notification) {
        const container = document.getElementById('notification-container-global');
        if (!container) {
            console.error('‚ùå Notification container not found');
            return;
        }

        const toastId = 'notification-' + Date.now();
        const toast = document.createElement('div');
        toast.id = toastId;
        toast.className = `notification notification-${notification.type}`;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.setAttribute('aria-atomic', 'true');
        toast.style.position = 'relative';
        toast.style.marginBottom = '10px';
        toast.style.padding = '15px';
        toast.style.borderRadius = '4px';
        toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
        toast.style.color = '#fff';
        toast.style.minWidth = '300px';
        toast.style.maxWidth = '400px';

        // –¶–≤–µ—Ç–∞ –ø–æ —Ç–∏–ø—É
        const colors = {
            'success': '#51a351',
            'error': '#bd362f',
            'warning': '#f89406',
            'info': '#2f96b4'
        };

        toast.style.backgroundColor = colors[notification.type] || '#030303';

        // –ò–∫–æ–Ω–∫–∞ –ø–æ —Ç–∏–ø—É
        const iconClass = notification.icon || getNotificationIcon(notification.type);

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        const title = notification.title || getNotificationTitle(notification.type);

        toast.innerHTML = `
            <div class="notification-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="${iconClass}"></i>
                    <strong class="notification-title" style="font-size: 14px; font-weight: 600;">${title}</strong>
                </div>
                <button type="button" class="notification-close-button" style="background: none; border: none; color: #fff; font-size: 20px; cursor: pointer; line-height: 1;">
                    &times;
                </button>
            </div>
            <div class="notification-message" style="font-size: 13px; line-height: 1.4;">
                ${notification.message}
            </div>
            ${notification.progressBar ?
                `<div class="notification-progress" style="position: absolute; bottom: 0; left: 0; height: 3px; background: rgba(255,255,255,0.3); width: 100%; overflow: hidden;">
                    <div class="notification-progress-bar" style="height: 100%; background: #fff; width: 100%; animation: progress ${notification.timeOut || 5000}ms linear forwards;"></div>
                </div>`
                : ''}
        `;

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        const style = document.createElement('style');
        style.textContent = `
            @keyframes progress {
                from { width: 100%; }
                to { width: 0%; }
            }
        `;
        document.head.appendChild(style);

        container.appendChild(toast);

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
            toast.style.transition = 'all 0.3s ease';
            toast.style.opacity = '1';
            toast.style.transform = 'translateX(0)';
        }, 10);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
        if (notification.timeOut > 0) {
            setTimeout(() => {
                closeNotificationToast(toastId);
            }, notification.timeOut);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
        const closeBtn = toast.querySelector('.notification-close-button');
        if (closeBtn) {
            closeBtn.addEventListener('click', function() {
                closeNotificationToast(toastId);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ toast
        if (notification.onclick) {
            toast.addEventListener('click', function() {
                try {
                    eval(notification.onclick);
                } catch (e) {
                    console.error('Error executing onclick:', e);
                }
            });
        }
    }

    function closeNotificationToast(toastId) {
        const toast = document.getElementById(toastId);
        if (toast) {
            toast.style.transition = 'all 0.3s ease';
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(100%)';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }
    }

    function getNotificationIcon(type) {
        const icons = {
            'success': 'ri-checkbox-circle-fill',
            'error': 'ri-error-warning-fill',
            'warning': 'ri-alert-fill',
            'info': 'ri-information-fill'
        };
        return icons[type] || 'ri-information-fill';
    }

    function getNotificationTitle(type) {
        const titles = {
            'success': '–£—Å–ø–µ—à–Ω–æ',
            'error': '–û—à–∏–±–∫–∞',
            'warning': '–í–Ω–∏–º–∞–Ω–∏–µ',
            'info': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
        };
        return titles[type] || '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ JS (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ)
    window.showNotificationToast = function(type, message, title = '', options = {}) {
        const notification = {
            type: type,
            message: message,
            title: title || getNotificationTitle(type),
            icon: options.icon || getNotificationIcon(type),
            timeOut: options.timeOut || 5000,
            closeButton: options.closeButton !== false,
            progressBar: options.progressBar !== false,
            onclick: options.onclick,
            template: 'notifications'
        };

        showNotificationToast(notification);
    };
});
</script>